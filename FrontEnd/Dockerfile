# 1ï¸âƒ£ Node.js 20 ë²„ì „ ê¸°ë°˜ìœ¼ë¡œ ë¹Œë“œ
FROM node:20.10.0 AS build
WORKDIR /app

# 2ï¸âƒ£ íŒ¨í‚¤ì§€ ê´€ë ¨ íŒŒì¼ ë³µì‚¬ ë° ì„¤ì •
COPY package.json yarn.lock ./

# Corepack í™œì„±í™” ë° Yarn ìµœì‹  ë²„ì „ ì ìš©
RUN corepack enable
RUN yarn set version berry  # ğŸ”¥ Yarn Berry(PnP) ë°©ì‹ ìœ ì§€
# RUN yarn plugin import typescript  # ğŸ”¥ TypeScript í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€

# ğŸ“Œ PnP ë°©ì‹ ì„¤ì •ì„ ìœ„í•´ node-modules ì‚¬ìš© ì•ˆí•¨
# RUN yarn config set nodeLinker pnp

# 3ï¸âƒ£ í”„ë¡œì íŠ¸ ì½”ë“œ ë³µì‚¬ í›„ ì˜ì¡´ì„± ì„¤ì¹˜
COPY . . 

# ğŸ“Œ `.pnp.cjs`ê°€ ì •ìƒ ìƒì„±ë˜ë„ë¡ `yarn install`
RUN yarn install --immutable

# 4ï¸âƒ£ TypeScript íŒ¨í‚¤ì§€ í™•ì¸ (ì—†ìœ¼ë©´ ì„¤ì¹˜)
RUN yarn why typescript || yarn add --dev typescript

# 6ï¸âƒ£ TypeScript ì˜¤ë¥˜ ë¬´ì‹œí•˜ë©´ì„œ ë¹Œë“œ ì§„í–‰
RUN yarn build 
# --skipLibCheck --noEmitOnError false || true

# 7ï¸âƒ£ Nginxê°€ ì‚¬ìš©í•  ë¹Œë“œ ë””ë ‰í† ë¦¬ ì„¤ì • (Nginx ì„¤ì •ê³¼ ì¼ì¹˜!)
RUN mkdir -p /home/ubuntu/frontend_build
RUN cp -r /app/dist/* /home/ubuntu/frontend_build

# 8ï¸âƒ£ Nginx ì»¨í…Œì´ë„ˆì—ì„œ ì‚¬ìš©í•  ë¹Œë“œ í´ë” ì§€ì •
VOLUME /home/ubuntu/frontend_build
